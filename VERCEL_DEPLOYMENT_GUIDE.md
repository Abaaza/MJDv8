# Complete Vercel Deployment Guide (Frontend + Backend + Storage)

## Why Vercel is Perfect

- ‚úÖ **Frontend + Backend** in one place
- ‚úÖ **Zero configuration** - just push to GitHub
- ‚úÖ **Vercel Blob** for file storage (better than S3)
- ‚úÖ **Automatic HTTPS** and global CDN
- ‚úÖ **No CORS issues** - everything on same domain
- ‚úÖ **Serverless functions** that scale automatically
- ‚úÖ **Free tier** generous enough for most apps

## Step 1: Prepare Your Dependencies

Add Vercel Blob to your server dependencies:

```bash
cd server
npm install @vercel/blob
```

## Step 2: Update Client Build Script

In `client/package.json`, make sure you have:

```json
{
  "scripts": {
    "build": "vite build",
    "dev": "vite dev"
  }
}
```

## Step 3: Deploy to Vercel

### Option A: Via Vercel Dashboard (Easiest)

1. **Go to [vercel.com](https://vercel.com)**
2. **Sign up with GitHub**
3. **Import your repository**
4. **Configure:**
   - Framework Preset: `Other`
   - Root Directory: `./` (keep default)
   - Build Command: (leave empty - Vercel will auto-detect)
   - Output Directory: (leave empty)

### Option B: Via Vercel CLI

```bash
npm i -g vercel
vercel login
vercel --prod
```

## Step 4: Add Environment Variables

In Vercel dashboard ‚Üí Settings ‚Üí Environment Variables:

| Variable                    | Value                                      | Environment |
| --------------------------- | ------------------------------------------ | ----------- |
| `SUPABASE_URL`              | `https://yqsumodzyahvxywwfpnc.supabase.co` | Production  |
| `SUPABASE_ANON_KEY`         | `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`  | Production  |
| `SUPABASE_SERVICE_ROLE_KEY` | (Your service role key)                    | Production  |
| `NODE_ENV`                  | `production`                               | Production  |
| `BLOB_READ_WRITE_TOKEN`     | (Auto-generated by Vercel Blob)            | Production  |

## Step 5: Enable Vercel Blob Storage

1. **In Vercel dashboard** ‚Üí Your project ‚Üí Storage
2. **Click "Create Database"** ‚Üí **Blob**
3. **Connect to your project**
4. Vercel automatically adds `BLOB_READ_WRITE_TOKEN` to your environment

## Step 6: Update Frontend API Configuration

Your frontend will automatically use the same domain, so update `client/src/lib/api.ts`:

```typescript
// Remove the API_BASE_URL since we're on the same domain
const API_BASE_URL = ""; // Empty string for same-origin requests

// Or use environment variable for flexibility
const API_BASE_URL = import.meta.env.VITE_API_URL || "";
```

## Step 7: Test Your Deployment

After deployment, your app will be available at:

- **Frontend**: `https://your-app.vercel.app`
- **Backend API**: `https://your-app.vercel.app/health`
- **Price Matching**: `https://your-app.vercel.app/price-matching/`
- **User Management**: `https://your-app.vercel.app/user-management/`

Test the health endpoint:

```bash
curl https://your-app.vercel.app/health
```

Should return:

```json
{ "status": "ok", "timestamp": "2024-01-20T10:00:00.000Z" }
```

## How It Works

### Frontend (React/Vite)

- Built automatically from `client/` directory
- Served as static files from global CDN
- Environment variables available at build time

### Backend (Express/Node.js)

- Runs as Vercel serverless functions
- Each API route becomes a separate function
- Automatically scales based on traffic
- 30-second timeout per request

### Storage (Vercel Blob)

- Replaces AWS S3
- Simpler API and better integration
- Automatic CDN distribution
- No bucket configuration needed

### Database (Supabase)

- Remains the same - works perfectly with Vercel
- All your existing queries work unchanged

## Advantages Over Other Platforms

| Feature            | Vercel      | AWS Lambda | Railway/Render |
| ------------------ | ----------- | ---------- | -------------- |
| Setup Complexity   | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê  | ‚≠ê‚≠ê       | ‚≠ê‚≠ê‚≠ê‚≠ê       |
| Frontend + Backend | ‚úÖ          | ‚ùå         | ‚ùå             |
| File Storage       | ‚úÖ Blob     | ‚úÖ S3      | ‚ùå             |
| CORS Issues        | ‚ùå None     | ‚ö†Ô∏è Common  | ‚ö†Ô∏è Possible    |
| Auto Scaling       | ‚úÖ          | ‚úÖ         | ‚ö†Ô∏è Limited     |
| Free Tier          | ‚úÖ Generous | ‚ö†Ô∏è Complex | ‚úÖ Good        |

## Monitoring & Debugging

### View Logs

- Vercel dashboard ‚Üí Functions ‚Üí View function logs
- Real-time logs for each API call
- Error tracking and performance metrics

### Analytics

- Built-in analytics for both frontend and backend
- Performance monitoring
- Error tracking

### Deployment History

- Every deployment is versioned
- Easy rollback to previous versions
- Preview deployments for branches

## Cost Structure

### Free Tier Includes:

- 100GB bandwidth/month
- 1GB Blob storage
- 100GB-hours serverless function execution
- Unlimited static deployments
- Custom domains

### Paid Plans Start at $20/month:

- 1TB bandwidth
- 100GB Blob storage
- 1000GB-hours function execution
- Team collaboration features

## Updating Your App

### Automatic Deployments

- Push to `main` branch ‚Üí Automatic production deployment
- Push to other branches ‚Üí Preview deployments
- No manual deployment needed

### Manual Deployment

```bash
vercel --prod
```

## Troubleshooting

### Build Fails

- Check build logs in Vercel dashboard
- Ensure all dependencies are in `package.json`
- Verify build commands are correct

### Function Errors

- Check function logs in dashboard
- Verify environment variables are set
- Test locally with `vercel dev`

### Storage Issues

- Ensure Blob storage is connected
- Check `BLOB_READ_WRITE_TOKEN` is set
- Verify file upload/download logic

## Local Development

```bash
# Install Vercel CLI
npm i -g vercel

# Run locally (simulates Vercel environment)
vercel dev

# Your app runs at http://localhost:3000
# Both frontend and backend work together
```

## Migration from Current Setup

1. ‚úÖ **No code changes needed** - your existing code works
2. ‚úÖ **Same database** - Supabase integration unchanged
3. ‚úÖ **Better file storage** - Vercel Blob replaces S3
4. ‚úÖ **Same features** - everything works as before
5. ‚úÖ **Better performance** - global CDN and edge functions

## Next Steps

1. **Deploy to Vercel** (5 minutes)
2. **Enable Blob storage** (1 minute)
3. **Add environment variables** (2 minutes)
4. **Test everything** (5 minutes)
5. **üéâ Your app is live globally!**

Your entire application will be deployed on Vercel's global infrastructure with automatic scaling, CDN, and zero configuration!
